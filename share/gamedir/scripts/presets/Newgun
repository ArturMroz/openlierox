#!/usr/bin/python -u

import random

global worms, io, controlHandler, wormDiedHandler, newWormHandler, gameStartedHandler, wormSpawnedHandler

setvar( "GameOptions.GameInfo.ModName", "Classic" )

setvar( "GameOptions.GameInfo.LoadingTime", "100" )

SetWeaponBans("Bonus only")

weaponChoices = [
	[
		"Doomsday", "Cannon", "Napalm", "Spikeballs", "Super Shotgun", "Larpa", "Laser", "Minigun", "Rifle",
	],
	[
		"Bazooka", "Bouncy Larpa", "Bouncy Mine", "Chaingun", "Explosives", "Flamer", "Gauss Gun", "Handgun", "Mini Rockets", "Winchester", "Zimm",
	],
	[
		"Big Nuke", "Blaster", "Crackler", "Dart", "Float Mine", "Grasshopper", "Hellraider", "Mine", "Mini Nuke", "RB Rampage", "Shotgun", "Uzi",
	],
]

weaponList = []
for i in range(len(weaponChoices)):
	weaponList.extend(random.sample(weaponChoices[i], 5))

for wormid in worms.keys():
	io.privateMsg(wormid, "New guns: " + ", ".join(weaponList))

def gameStartedNewGun():
	global worms, weaponList, io
	for wormid in worms.keys():
		worms[wormid].newgunCount = 0
		io.privateMsg(wormid, "New guns: " + ", ".join(weaponList))
		#weapon = weaponList[0]
		#io.setWormWeapons(wormid, weapon, weapon, weapon, weapon, weapon)

def newWormNewGun(wormid, name):
	global worms, weaponList, io
	worms[wormid].newgunCount = 10 # Penalty for joining mid-game
	weapon = weaponList[10]
	io.privateMsg(wormid, "New guns: " + ", ".join(weaponList))

def wormSpawnedNewGun(wormid):
	global worms, weaponList, io
	weapon = weaponList[worms[wormid].newgunCount % len(weaponList)]
	io.setWormWeapons(wormid, weapon, weapon, weapon, weapon, weapon)

def wormDiedNewGun(died, killer):
	global worms, weaponList, io
	if killer != died:
		worms[killer].newgunCount += 1
		weapon = weaponList[worms[killer].newgunCount % len(weaponList)]
		io.setWormWeapons(killer, weapon, weapon, weapon, weapon, weapon)
		#io.privateMsg(killer, "New gun: " + weapon)

gameStartedHandler = gameStartedNewGun
newWormHandler = newWormNewGun
wormDiedHandler = wormDiedNewGun
wormSpawnedHandler = wormSpawnedNewGun

